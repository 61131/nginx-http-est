# nginx-http-est

Enrollment over Secure Transport (EST) module for Nginx

The Enrollment over Secure Transport (EST) protocol describes a simple, yet functional, certificate management protocol targeting Public Key Infrastructure (PKI) clients that need to acquire client certificates and associated Certification Authority (CA) certificates. This protocol supports both client-generated public/private key pairs and those generated by the CA.

The nginx-http-est module provides EST functionality for a Nginx server.

## Build

To build the nginx-http-est module from the Nginx source directory:

    ./configure --add-module=/path/to/nginx-http-est --with-http_ssl_module
    make
    make install

Note that the nginx-http-est module is dependent upon the HTTP SSL module for normal operations. 

## Configuration

    server {
        ssl_certificate /etc/nginx/ssl/Server.crt;
        ssl_certificate_key /etc/nginx/ssl/Server.key;

        ssl_client_certificate /etc/nginx/ssl/Org-RootCA.crt;
        ssl_verify_client optional;

        listen 443 ssl;
        listen 80 default_server;

        location / {
            ...
        }

        location /.well-known/est {
            est on;
            est_verify_client cert;
            est_root_certificate /etc/nginx/ssl/Org-RootCA.crt;
        }
    }

## Parameters

### est

* **syntax:** `est on|off`
* **default:** `off`
* **context:** `location`

Enable EST operations for HTTP SSL server location. 

The EST server MUST support the path-prefix of "/.well-known/" as defined in [RFC 5785](https://datatracker.ietf.org/doc/html/rfc5785) and the registered name of "est". As such, the default EST server URI path would be "https://www.example.com/.well-known/est". This can be configured through the creation of a location definition for "/.well-known/est" as shown in the example configuration above.

An EST server may also support service for multiple CAs as indicated by an optional additional path segment between the registered application name and the operation path. This can be supported by this module through the inclusion of multiple location directives within the server configuration.

### est_verify_client

* **syntax:** `est_verify_client none|auth|cert|both`
* **default:** `cert`
* **context:** `location`

Configures the mechanism to be used for verifying EST clients. 

The EST server authenticates and authorizes EST clients as specified in Sections 3.3.2, 3.3.3 and 3.7 in [RFC 7030](https://datatracker.ietf.org/doc/html/rfc7030).

The only values supported for the est_verify_client directive at this time are `none` and `cert` (certificate).

### est_root_certificate

* **syntax:** `est_root_certificate <filename>`
* **default:** `none`
* **context:** `location`

Configures the trust anchor certificate to be used for EST operations.

This directive specifies the certificate - in PEM format - to be returned to EST clients to bootstrap the trust anchor between client and server. EST clients may request this trust anchor certificate information with a HTTPS GET message using an operation path of "/cacerts". The EST server will not require client authentication or authorization to reply to this request.

## References

* [RFC 7030 Enrollment over Secure Transport](https://datatracker.ietf.org/doc/html/rfc7030)
 

